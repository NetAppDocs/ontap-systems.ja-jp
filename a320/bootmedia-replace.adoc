---
permalink: a320/bootmedia-replace.html 
sidebar: sidebar 
keywords: aff, a320, aff a320, boot, media, store, primary, secondary, set, system, boot, image, file, replace, replace the boot media 
summary: ブートメディアには、システムがブート時に使用するシステムファイル（ブートイメージ）のプライマリセットとセカンダリセットが格納されています。 
---
= コントローラモジュールを取り外し、ブートメディアを交換して、ブートイメージをブートメディア - AFF A320 に転送します
:icons: font
:imagesdir: ../media/


ブートメディアを交換するには、障害のあるコントローラモジュールを取り外し、交換用ブートメディアを取り付けて、ブートイメージを USB フラッシュドライブに転送する必要があります。



== 手順 1 ：コントローラモジュールを取り外す

[role="lead"]
コントローラモジュール内部のコンポーネントにアクセスするには、コントローラモジュールをシャーシから取り外す必要があります。

. 接地対策がまだの場合は、自身で適切に実施します。
. コントローラモジュールの電源装置のコードを電源から抜きます。
. ケーブルマネジメントデバイスに接続しているケーブルをまとめているフックとループストラップを緩め、システムケーブルと SFP をコントローラモジュールから外し（必要な場合）、どのケーブルが何に接続されていたかを記録します。
+
image::../media/drw_a320_controller_cable_unplug_animated_gif.png[DRW A320 コントローラケーブルプラグアニメーション GIF]

+
ケーブルはケーブルマネジメントデバイスに収めたままにします。これにより、ケーブルマネジメントデバイスを取り付け直すときに、ケーブルを整理する必要がありません。

. ケーブルマネジメントデバイスをコントローラモジュールの右側と左側から取り外し、脇に置きます。
. コントローラモジュールをシャーシから取り外します。
+
image::../media/drw_a320_controller_remove_animated_gif.png[DRW A320 コントローラアニメーション GIF を削除します]

+
.. コントローラモジュールの両側にあるラッチ機構に人差し指をかけます。
.. ラッチ機構の上部にあるオレンジ色のタブを押し下げて、シャーシのラッチピンを解除します。
+
ラッチ機構のフックがほぼ垂直に位置し、シャーシピンから解除されている必要があります。

.. コントローラモジュールの側面を持てるように、コントローラモジュールをゆっくりと少し手前に引き出します。
.. コントローラモジュールを両手でシャーシからゆっくりと引き出し、平らで安定した場所に置きます。






== 手順 2 ：ブートメディアを交換します

[role="lead"]
コントローラモジュールのブートメディアの場所を確認し、手順に従って交換する必要があります。

. エアダクトを開き、次の図またはコントローラモジュールの FRU マップを使用してブートメディアの場所を確認します。
. コントローラモジュールからブートメディアの場所を確認して取り出します。
+
image::../media/drw_a320_boot_media_replace_animated_gif.png[DRW A320 ブートメディアはアニメーション GIF に置き換えられます]

+
.. ブートメディアの横の青いボタンを押して、ブートメディアの端を青いボタンの上まで跳ね上げます。
.. ブートメディアを回しながらソケットからゆっくりと引き出します。
+
... ブートメディアが正しい向きでソケットに完全に装着されたことを確認します。




+
必要に応じて、ブートメディアを取り外してソケットへの装着をやり直します。

. ブートメディアを所定の位置にロックします。
+
.. ブートメディアをマザーボードの方に回転させます。
.. ブートメディアの横の青いボタンを押し、ブートメディアの端を押し下げて、青いロックボタンをはめ込みます。
.. ブートメディアを押し下げながら青いロックボタンを持ち上げて、ブートメディアを所定の位置にロックします。


. エアダクトを閉じます。




== 手順 3 ： USB フラッシュドライブを使用してブートイメージをブートメディアに転送します

[role="lead"]
取り付けた交換用ブートメディアにはブートイメージが含まれていないため、 USB フラッシュドライブを使用してブートイメージを転送する必要があります。

* 4GB 以上の容量の MBR / FAT32 にフォーマットされた USB フラッシュドライブが必要です
* 障害のあるコントローラが実行していたバージョンの ONTAP イメージのコピー。該当するイメージは、ネットアップサポートサイトのダウンロードセクションからダウンロードできます
+
** NVE が有効な場合は、ダウンロードボタンの指示に従って、 NetApp Volume Encryption を使用してイメージをダウンロードします。
** NVE が有効になっていない場合は、ダウンロードボタンの指示に従って、 NetApp Volume Encryption なしでイメージをダウンロードします。


* HA ペアのシステムの場合は、ネットワーク接続が必要です。
* スタンドアロンシステムの場合はネットワーク接続は必要ありませんが、 var ファイルシステムをリストアしたときに追加のリブートを実行する必要があります。
+
.. ネットアップサポートサイトから USB フラッシュドライブに適切なサービスイメージをダウンロードしてコピーします。
+
... ラップトップの作業スペースにサービスイメージをダウンロードします。
... サービスイメージを解凍します。
+

NOTE: Windows を使用して内容を展開する場合は、 winzip を使用してネットブートイメージを展開しないでください。7-Zip や WinRAR など、別の抽出ツールを使用します。

+
解凍されたサービスイメージファイルには、次の 2 つのフォルダがあります。

+
**** /boot
**** EFI


... EFI フォルダを USB フラッシュドライブの最上位ディレクトリにコピーします。
+
USB フラッシュドライブには、 EFI フォルダと、障害のあるコントローラが実行しているものと同じバージョンの Service Image （ BIOS ）が必要です。

... USB フラッシュドライブをラップトップから取り外します。


.. まだ行っていない場合は、エアダクトを閉じます。
.. コントローラモジュールの端をシャーシの開口部に合わせ、コントローラモジュールをシステムに半分までそっと押し込みます。
.. ケーブルマネジメントデバイスを再び取り付け、必要に応じてシステムにケーブルを再接続します。
+
ケーブルを再接続する際は、メディアコンバータ（ SFP または QSFP ）も取り付け直してください（メディアコンバータを取り外した場合）。

.. 電源装置に電源ケーブルを接続し、電源ケーブルの固定クリップを再度取り付けます。
.. USB フラッシュドライブをコントローラモジュールの USB スロットに挿入します。
+
USB フラッシュドライブは、 USB コンソールポートではなく、 USB デバイス用のラベルが付いたスロットに取り付けてください。

.. コントローラモジュールの再取り付けを完了します。
+
... ラッチアームが引き出された位置で固定されていることを確認します。
... ラッチアームを使用して、コントローラモジュールをシャーシベイの奥まで押し込みます。
+

NOTE: ラッチアームの上部にあるラッチを押し下げないでください。そのためには、ロックを上げて、コントローラモジュールがシャーシにスライドしないようにします。

... ラッチ上部にあるオレンジ色のタブを押し下げます。
... コントローラモジュールをシャーシの端と揃うまで、シャーシベイにそっと押し込みます。
+

NOTE: ラッチのアームがシャーシ内にスライドします。

+
コントローラモジュールは、シャーシに完全に装着されるとすぐにブートを開始します。

... ラッチを外してコントローラモジュールを所定の位置に固定します。
... ケーブルマネジメントデバイスをまだ取り付けていない場合は、取り付け直します。


.. Ctrl+C キーを押してブートプロセスを中断し、 LOADER プロンプトで停止します。
+
このメッセージが表示されない場合は、 Ctrl+C キーを押し、メンテナンスモードでブートするオプションを選択して、ノードを停止して LOADER プロンプトを表示します。

.. 環境変数と bootargs は保持されますが 'printenv bootargname' コマンドを使用して ' 必要なすべてのブート環境変数と bootargs がシステムタイプと構成に適切に設定されていることを確認し 'setenv variable-name <value> コマンドを使用してエラーを修正する必要があります
+
... ブート環境変数を確認します。
+
**** bootarg.init.boot_clustered`
**** 「 partner-sysid 」
**** AFF C190 / AFF A220 （オールフラッシュ FAS ）用 bootarg.init.flash_optimized`
**** AFF A220 およびオール SAN アレイの場合は bootarg.init.san_optimized`
**** bootarg.init.switchless_cluster.enable`


... 外部キーマネージャが有効になっている場合は、「 kenv 」 ASUP 出力に表示された bootarg 値を確認します。
+
**** bootarg.storageencryption.support <value>
**** bootarg.keymanager. support <value>
**** 「 kmip.init.interface 」 <value> です
**** 「 kmip.init.ipaddr 」 <value> です
**** 「 kmip.init.netmask 」 <value> です
**** 「 kmip.init.gateway 」 <value> です


... オンボードキーマネージャが有効になっている場合は、「 kenv 」 ASUP 出力に表示されている bootarg 値を確認します。
+
**** bootarg.storageencryption.support <value>
**** bootarg.keymanager. support <value>
**** 'bootarg.onboard keymanager <value>


... 'avenv' コマンドを使用して変更した環境変数を保存します
... printenv_variable-name_` コマンドを使用して、変更を確認します。


.. LOADER プロンプトから、 USB フラッシュドライブ「 boot_recovery 」からリカバリ・イメージをブートします
+
イメージが USB フラッシュドライブからダウンロードされます。

.. プロンプトが表示されたら、イメージの名前を入力するか、画面に表示されたデフォルトのイメージをそのまま使用します。
.. イメージがインストールされたら、リストアプロセスを開始します。
+
... 画面に表示される障害ノードの IP アドレスをメモします。
... バックアップ構成を復元するかどうかを確認するメッセージが表示されたら 'y' を押します
... /etc/ssh/ssh_host_DSA_KEY を上書きするかどうかを確認するメッセージが表示されたら 'y' を押します


.. advanced 権限レベルのパートナーノードから、前の手順でメモした IP アドレスを使用して設定の同期を開始します。「 system node restore-backup -node local-target-address_impaired_node_name _
.. リストアに成功した場合は、リストアしたコピーを使用するかどうかを確認するメッセージが表示されたら、障害ノードで「 y 」を押します。
.. バックアップ手順が成功したことを確認したら 'y' を押し ' ノードを再起動するよう求められたら 'y' を押します
.. 環境変数が正しく設定されていることを確認します。
+
... ノードに LOADER プロンプトを表示します。
+
ONTAP プロンプトから問題、 system node halt -skip-lif-migration-before-shutdown true -ignore-quorum -warnings true -inhibit-takeover true コマンドを実行できます。

... printenv コマンドを使用して ' 環境変数の設定を確認します
... 環境変数が正しく設定されていない場合は 'setenv_environment-variable-name___ changed-value_` コマンドで変更します
... 「 avenev 」コマンドを使用して変更を保存します。
... ノードをリブートします。


.. リブートされた障害ノードに「 Waiting for giveback... 」というメッセージが表示されたら、正常なノードからギブバックを実行します。
+
[cols="1,2"]
|===
| システムの構成 | 作業 


 a| 
HA ペア
 a| 
障害ノードに「 Waiting for giveback... 」というメッセージが表示されたら、正常なノードからギブバックを実行します。

... 正常なノードから：「 storage failover giveback -ofnode partner_node_name
+
障害ノードはストレージをテイクバックしてブートを完了し、その後リブートして再び正常なノードによってテイクオーバーされます。

+

NOTE: ギブバックが拒否されている場合は、拒否を無効にすることを検討してください。

+
http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-hacg/home.html["ONTAP 9 ハイアベイラビリティ構成ガイド"]

... storage failover show-giveback コマンドを使用して、ギブバック処理の進捗を監視します。
... ギブバック処理が完了したら、「 storage failover show 」コマンドを使用して、 HA ペアが正常でテイクオーバーが可能であることを確認します。
... storage failover modify コマンドを使用して自動ギブバックを無効にした場合は、自動ギブバックをリストアします。


|===
.. 正常なノードで advanced 権限レベルを終了します。



