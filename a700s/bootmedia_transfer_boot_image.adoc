---
permalink: a700s/bootmedia-transfer-boot-image.html 
sidebar: sidebar 
keywords: aff a700s, aff, a700s, procedure, secondary, boot, media, restore, fail, image, tgz, file, trasnfer, usb, flash, drive, transfer the boot image to the boot medai using a usb flash drive 
summary: この手順は、セカンダリブートメディアのリストアに失敗した場合、または image.tgz ファイルがセカンダリブートメディアに見つからない場合にのみ使用します。 
---
= ブートイメージをブートメディア - AFF A700s に転送します
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
を使用して交換用ブートメディアにシステムイメージをインストールするには、コントローラモジュールに取り付けられている 2 番目のブートメディアにあるイメージを使用します。これは、システムイメージをリストアする際の主な方法です。 セカンダリブートメディアのリストアに失敗した場合や、セカンダリブートメディアに image.tgz ファイルが見つからない場合は、 USB フラッシュドライブを使用してブートメディアにブートイメージを転送することもできます。



== オプション 1 ： 2 つ目のブートメディアのバックアップリカバリを使用してファイルをブートメディアに転送する

コントローラモジュールに取り付けたセカンダリブートメディア上のイメージを使用して、交換用ブートメディアにシステムイメージをインストールできます。これは、コントローラモジュールに 2 つのブートメディアがあるシステムで、ブートメディアファイルを交換用ブートメディアに転送する主要な方法です。

セカンダリブートメディア上のイメージには 'image.tgz ファイルが含まれていて ' 障害を報告していないことが必要ですimage.tgz ファイルがない場合、またはブートメディアから障害が報告されている場合は、この手順を使用できません。USB フラッシュドライブ交換用手順を使用して、ブートイメージを交換用ブートメディアに転送する必要があります。

.手順
. 接地対策がまだの場合は、自身で適切に実施します。
. まだ行っていない場合は、エアダクトを閉じます。
+
.. エアダクトをコントローラモジュールまで下げます。
.. カチッという音がして固定ツメが所定の位置に収まるまで、エアダクトをライザーの方向にスライドさせます。
.. エアダクトが正しく取り付けられ、所定の位置に固定されていることを確認します。
+
image::../media/drw_a700s_close_air_duct.png[DRW a700s 閉エアダクト]

+
|===


 a| 
image:../media/legend_icon_01.png[""]
 a| 
エアダクト



 a| 
image:../media/legend_icon_02.png[""]
 a| 
ライザー

|===


. コントローラモジュールの端をシャーシの開口部に合わせ、コントローラモジュールをシステムに半分までそっと押し込みます。
. ケーブルマネジメントデバイスを再び取り付け、必要に応じてシステムにケーブルを再接続します。
+
ケーブルを再接続する際は、メディアコンバータ（ SFP ）も取り付け直してください（メディアコンバータを取り外した場合）。

. 電源装置にケーブルを再接続し、電源に接続します。
+
電源コードに電源ケーブルロックカラーを再度取り付けてください。

. コントローラモジュールの固定フックが持ち上がるまで、コントローラモジュールをシステムの奥に押し込みます。固定フックを強く押し込んでコントローラモジュールを装着し、固定フックをコントローラモジュールのピンにかけてロックします。
+
コントローラは、シャーシに完全に取り付けられるとすぐにブートを開始します。

. Ctrl+C キーを押してブートプロセスを中断し、 LOADER プロンプトで停止します。
+
このメッセージが表示されない場合は、 Ctrl+C キーを押し、メンテナンスモードでブートするオプションを選択してから、コントローラを停止して LOADER プロンプトを表示します。

. LOADER プロンプトから、セカンダリブートメディア「 boot_recovery 」からリカバリ・イメージをブートします
+
イメージがセカンダリブートメディアからダウンロードされます。

. プロンプトが表示されたら、イメージの名前を入力するか、画面に表示されたデフォルトのイメージをそのまま使用します。
. イメージがインストールされたら、リストアプロセスを開始します。
+
.. 画面に表示される障害が発生したコントローラの IP アドレスをメモします。
.. バックアップ構成を復元するかどうかを確認するメッセージが表示されたら 'y' を押します
.. バックアップ手順が成功したことを確認するプロンプトが表示されたら 'y' を押します


. advanced 権限レベルのパートナーコントローラから、前の手順で記録した IP アドレスを使用して設定の同期を開始します。「 system node restore-backup -node local-target-impaired_node_name _ip_address _`
. 設定の同期化がエラーなしで完了したら ' バックアップ手順が成功したことを確認するプロンプトが表示されたら 'y' を押します
. 復元されたコピーを使用するかどうかを確認するメッセージが表示されたら 'y' を押し ' プロンプトが表示されたら 'y' を押してコントローラを再起動します
. 正常なコントローラで advanced 権限レベルを終了します。




== オプション 2 ： USB フラッシュドライブを使用してブートイメージをブートメディアに転送する

この手順は、セカンダリブートメディアのリストアに失敗した場合、または image.tgz ファイルがセカンダリブートメディアに見つからない場合にのみ使用します。

* FAT32 にフォーマットされた、 4GB 以上の容量の USB フラッシュドライブが必要です。
* 障害のあるコントローラが実行していたバージョンの ONTAP イメージのコピー。該当するイメージは、ネットアップサポートサイトのダウンロードセクションからダウンロードできます
+
** NVE が有効な場合は、ダウンロードボタンの指示に従って、 NetApp Volume Encryption を使用してイメージをダウンロードします。
** NVE が有効になっていない場合は、ダウンロードボタンの指示に従って、 NetApp Volume Encryption なしでイメージをダウンロードします。


* HA ペアのシステムの場合は、ネットワーク接続が必要です。
* スタンドアロンシステムの場合はネットワーク接続は必要ありませんが、 var ファイルシステムをリストアしたときに追加のリブートを実行する必要があります。


.手順
. 接地対策がまだの場合は、自身で適切に実施します。
. まだ行っていない場合は、エアダクトを閉じます。
+
.. エアダクトをコントローラモジュールまで下げます。
.. カチッという音がして固定ツメが所定の位置に収まるまで、エアダクトをライザーの方向にスライドさせます。
.. エアダクトが正しく取り付けられ、所定の位置に固定されていることを確認します。
+
image::../media/drw_a700s_close_air_duct.png[DRW a700s 閉エアダクト]

+
|===


 a| 
image:../media/legend_icon_01.png[""]
 a| 
エアダクト



 a| 
image:../media/legend_icon_02.png[""]
 a| 
ライザー

|===


. コントローラモジュールの端をシャーシの開口部に合わせ、コントローラモジュールをシステムに半分までそっと押し込みます。
. ケーブルマネジメントデバイスを再び取り付け、必要に応じてシステムにケーブルを再接続します。
+
ケーブルを再接続する際は、メディアコンバータ（ SFP ）も取り付け直してください（メディアコンバータを取り外した場合）。

. 電源装置にケーブルを再接続し、電源に接続します。
+
電源コードに電源ケーブルロックカラーを再度取り付けてください。

. USB フラッシュドライブをコントローラモジュールの USB スロットに挿入します。
+
USB フラッシュドライブは、 USB コンソールポートではなく、 USB デバイス用のラベルが付いたスロットに取り付けてください。

. コントローラモジュールの固定フックが持ち上がるまで、コントローラモジュールをシステムの奥に押し込みます。固定フックを強く押し込んでコントローラモジュールを装着し、固定フックをコントローラモジュールのピンにかけてロックします。
+
コントローラは、シャーシに完全に取り付けられるとすぐにブートを開始します。

. Ctrl+C キーを押してブートプロセスを中断し、 LOADER プロンプトで停止します。
+
このメッセージが表示されない場合は、 Ctrl+C キーを押し、メンテナンスモードでブートするオプションを選択してから、コントローラを停止して LOADER プロンプトを表示します。

. 環境変数と bootargs は保持されますが 'printenv bootargname' コマンドを使用して ' 必要なすべてのブート環境変数と bootargs がシステムタイプと構成に適切に設定されていることを確認し 'setenv variable-name <value> コマンドを使用してエラーを修正する必要があります
+
.. ブート環境変数を確認します。
+
*** bootarg.init.boot_clustered`
*** 「 partner-sysid 」
*** AFF C190 / AFF A220 （オールフラッシュ FAS ）用 bootarg.init.flash_optimized`
*** AFF A220 およびオール SAN アレイの場合は bootarg.init.san_optimized`
*** bootarg.init.switchless_cluster.enable`


.. 外部キーマネージャが有効になっている場合は、「 kenv 」 ASUP 出力に表示された bootarg 値を確認します。
+
*** bootarg.storageencryption.support <value>
*** bootarg.keymanager. support <value>
*** 「 kmip.init.interface 」 <value> です
*** 「 kmip.init.ipaddr 」 <value> です
*** 「 kmip.init.netmask 」 <value> です
*** 「 kmip.init.gateway 」 <value> です


.. オンボードキーマネージャが有効になっている場合は、「 kenv 」 ASUP 出力に表示されている bootarg 値を確認します。
+
*** bootarg.storageencryption.support <value>
*** bootarg.keymanager. support <value>
*** 'bootarg.onboard keymanager <value>


.. 'avenv' コマンドを使用して変更した環境変数を保存します
.. printenv_variable-name_` コマンドを使用して、変更を確認します。


. LOADER プロンプトから、 USB フラッシュドライブ「 boot_recovery 」からリカバリ・イメージをブートします
+
イメージが USB フラッシュドライブからダウンロードされます。

. プロンプトが表示されたら、イメージの名前を入力するか、画面に表示されたデフォルトのイメージをそのまま使用します。
. イメージがインストールされたら、リストアプロセスを開始します。
+
.. 画面に表示される障害が発生したコントローラの IP アドレスをメモします。
.. バックアップ構成を復元するかどうかを確認するメッセージが表示されたら 'y' を押します
.. バックアップ手順が成功したことを確認するプロンプトが表示されたら 'y' を押します


. 復元されたコピーを使用するかどうかを確認するメッセージが表示されたら 'y' を押し ' プロンプトが表示されたら 'y' を押してコントローラを再起動します
. advanced 権限レベルのパートナーコントローラから、前の手順で記録した IP アドレスを使用して設定の同期を開始します。「 system node restore-backup -node local-target-impaired_node_name _ip_address _`
. 設定の同期化がエラーなしで完了したら ' バックアップ手順が成功したことを確認するプロンプトが表示されたら 'y' を押します
. 復元されたコピーを使用するかどうかを確認するメッセージが表示されたら 'y' を押し ' プロンプトが表示されたら 'y' を押してコントローラを再起動します
. 環境変数が正しく設定されていることを確認します。
+
.. コントローラに LOADER プロンプトを表示します。
+
ONTAP プロンプトから、コマンド「 system node halt -skip-lif-migration-before-shutdown true -ignore-quorum -warnings true -inhibit-takeover true 」を問題 できます。

.. printenv コマンドを使用して ' 環境変数の設定を確認します
.. 環境変数が正しく設定されていない場合は 'setenv_environment-variable-name___ changed-value_` コマンドで変更します
.. 「 savenv 」コマンドを使用して、変更内容を保存します。
.. コントローラをリブートします。


. リブートされた障害のあるコントローラに「 Waiting for giveback... 」というメッセージが表示されたら、正常なコントローラからギブバックを実行します。
+
[cols="1,2"]
|===
| システムの構成 | 作業 


 a| 
HA ペア
 a| 
障害のあるコントローラに「 Waiting for giveback... 」というメッセージが表示されたら、正常なコントローラからギブバックを実行します。

.. 正常なコントローラから： storage failover giveback -ofnode partner_node_name
+
障害のあるコントローラはストレージをテイクバックしてブートを完了し、その後リブートして再び正常なコントローラによってテイクオーバーされます。

+

NOTE: ギブバックが拒否されている場合は、拒否を無効にすることを検討してください。

+
http://["ONTAP 9 ハイアベイラビリティ構成ガイド"]

.. 「 storage failover show-giveback 」コマンドを使用して、ギブバック処理の進捗を監視します。
.. ギブバック処理が完了したら、「 storage failover show 」コマンドを使用して、 HA ペアが正常でテイクオーバーが可能であることを確認します。
.. storage failover modify コマンドを使用して自動ギブバックを無効にした場合は ' 自動ギブバックをリストアします


|===
. 正常なコントローラで advanced 権限レベルを終了します。

