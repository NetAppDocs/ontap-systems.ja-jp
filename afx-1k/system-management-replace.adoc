---
permalink: afx-1k/system-management-replace.html 
sidebar: sidebar 
keywords: afx 1k, replace the system manager module 
summary: AFX 1K ストレージ システムのシステム管理モジュールに障害が発生した場合、またはファームウェアが破損した場合は、システム管理モジュールを交換してください。交換プロセスには、コントローラのシャットダウン、故障したシステム管理モジュールの交換、コントローラの再起動、ライセンス キーの更新、故障した部品のNetAppへの返却が含まれます。 
---
= システム管理モジュールの交換 - AFX 1K
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
AFX 1K ストレージ システムのシステム管理モジュールに障害が発生した場合、またはファームウェアが破損した場合は、システム管理モジュールを交換してください。交換プロセスには、コントローラのシャットダウン、故障したシステム管理モジュールの交換、コントローラの再起動、ライセンス キーの更新、故障した部品のNetAppへの返却が含まれます。

コントローラの背面、スロット 8 の左側にあるシステム管理モジュールには、システム管理用のオンボード コンポーネントと外部管理用のポートが含まれています。障害のあるシステム管理モジュールを交換するか、ブート メディアを交換するには、ターゲット コントローラをシャットダウンして電源をオフにする必要があります。

システム管理モジュールには、次のコンポーネントが搭載されています。

* ブートメディア（コントローラモジュールを取り外さずにブートメディアを交換可能）
* BMC
* 管理スイッチ


システム管理モジュールには、外部管理用の次のポートも含まれています。

* RJ45シリアル
* USBシリアル（Type-C）
* USB Type-A（ブートリカバリ）
* e0MおよびBMCネットワークアクセス用のRJ45イーサネットサービスポート


.作業を開始する前に
* 他のすべてのシステムコンポーネントが正常に動作していることを確認します。
* パートナーコントローラが障害のあるコントローラをテイクオーバーできることを確認します。
* 障害が発生したコンポーネントは、必ずNetAppから受け取った交換用コンポーネントと交換してください。


.このタスクについて
この手順では次の用語を使用します。

* 障害のあるコントローラとは、メンテナンスを実行しているコントローラです。
* 正常なコントローラとは、障害のあるコントローラの HA パートナーです。




== 手順 1 ：障害のあるコントローラをシャットダウンします

障害のあるコントローラをシャットダウンするかテイクオーバーします。

障害のあるコントローラをシャットダウンするには、コントローラのステータスを確認し、必要に応じてコントローラのストレージ フェイルオーバー テイクオーバーを実行して、正常なコントローラが障害のあるコントローラ ストレージから引き続きデータを提供できるようにする必要があります。

.このタスクについて
* 4 つ以上のノードを持つクラスターがある場合は、クォーラム内になければなりません。ノードに関するクラスター情報を表示するには、 `cluster show`指示。詳細については、 `cluster show`コマンドについては、link:https://docs.netapp.com/us-en/ontap/system-admin/display-nodes-cluster-task.html["ONTAPクラスタ内のノードレベルの詳細を表示する"^] 。
* クラスターがクォーラムにない場合、または (障害のあるコントローラー以外の) コントローラーの正常性または適格性が false と表示される場合は、障害のあるコントローラーをシャットダウンする前に問題を修正する必要があります。見るlink:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["ノードをクラスタと同期します"^] 。


.手順
. AutoSupportが有効になっている場合は、AutoSupportメッセージを呼び出してケースの自動作成を停止します。
+
`system node autosupport invoke -node * -type all -message MAINT=<# of hours>h`

+
次のAutoSupport メッセージは、ケースの自動作成を2時間停止します。

+
`cluster1:> system node autosupport invoke -node * -type all -message MAINT=2h`

. 障害のあるコントローラのコンソールからの自動ギブバックを無効にします。
+
`storage failover modify -node impaired-node -auto-giveback-of false`

+

NOTE: 「自動ギブバックを無効にしますか？」と表示されたら、次のように入力します。 `y` 。

+
.. ONTAPバージョン 9.17.1 を実行していて、障害のあるコントローラを起動できないか、すでに引き継がれている場合は、障害のあるコントローラを起動する前に、正常なコントローラから HA 相互接続リンクを停止する必要があります。これにより、障害のあるコントローラによる自動ギブバックの実行が防止されます。
+
`system ha interconnect link off -node healthy-node -link 0`

+
`system ha interconnect link off -node healthy-node -link 1`



. 障害のあるコントローラに LOADER プロンプトを表示します。
+
[cols="1,2"]
|===
| 障害のあるコントローラの表示 | 作業 


 a| 
LOADER プロンプト
 a| 
次の手順に進みます。



 a| 
システムプロンプトまたはパスワードプロンプト
 a| 
正常なコントローラから障害のあるコントローラを引き継ぐか、停止します。
`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

_-halt true_ パラメータは、障害のあるノードを LOADER プロンプトに表示します。

|===




== 手順2：障害のあるシステム管理モジュールを交換する

障害のあるシステム管理モジュールを交換してください。

. システム管理モジュールを取り外します。
+

NOTE: 続行する前にNVRAMのデステージが完了していることを確認してください。NVモジュールのLEDが消灯すると、NVRAMはデステージされます。LEDが点滅している場合は、点滅が停止するまで待ちます。点滅が5分以上続く場合は、テクニカルサポートにお問い合わせください。

+
image::../media/drw_a1k_sys-mgmt_remove_ieops-1384.svg[システム管理モジュールを交換してください]

+
[cols="1,4"]
|===


 a| 
image::../media/icon_round_1.png[番号1]
 a| 
システム管理モジュールのカムラッチ

|===
+
.. 接地対策がまだの場合は、自身で適切に実施します。
.. PSU から電源ケーブルを取り外します。
.. システム管理モジュールに接続されているケーブルをすべて取り外します。ケーブルが接続されていた場所にラベルを付けて、モジュールを再インストールするときに正しいポートに再接続できるようにします。
.. ケーブルマネジメントトレイ内部の両側にあるボタンを引いてケーブルマネジメントトレイを下に回転させ、トレイを下に回転させます。
.. システム管理モジュールのカムボタンを押します。
.. カムレバーをできるだけ下に回転させます。
.. カムレバーの穴に指を入れ、モジュールをシステムからまっすぐ引き出します。
.. ブート メディアにアクセスするには、システム管理モジュールを静電気防止マットの上に置きます。


. 交換用システム管理モジュールにブートメディアを移動します。
+
image::../media/drw_a1k_boot_media_remove_replace_ieops-1377.svg[ブートメディアの交換]

+
[cols="1,4"]
|===


 a| 
image::../media/icon_round_1.png[番号1]
 a| 
システム管理モジュールのカムラッチ



 a| 
image::../media/icon_round_2.png[番号2]
 a| 
ブートメディアロックボタン



 a| 
image::../media/icon_round_3.png[番号3]
 a| 
ブートメディア

|===
+
.. 障害のあるシステム管理モジュールの青色のブートメディアロックボタンを押します。
.. ブートメディアを上に回転させ、ソケットから引き出します。


. 交換用システム管理モジュールにブートメディアを取り付けます。
+
.. ブートメディアの端をソケットケースに合わせ、ソケットに対して垂直にゆっくりと押し込みます。
.. ロックボタンに触れるまでブートメディアを下に回転させます。
.. 青色の固定ボタンを押してブートメディアを最後まで回転させ、青色の固定ボタンを放します。


. 交換用システム管理モジュールをエンクロージャに取り付けます。
+
.. 交換用システム管理モジュールの端をシステム開口部に合わせ、コントローラモジュールにそっと押し込みます。
.. モジュールをスロットにそっと挿入し、カムラッチを上に回転させてモジュールを所定の位置にロックします。


. ケーブルマネジメントARMを閉位置まで回転させます。
. システム管理モジュールにケーブルを再接続します。




== 手順3：コントローラモジュールをリブートする

コントローラモジュールをリブートします。

. 電源ケーブルをPSUに再度差し込みます。
+
システムが再起動し、通常は LOADER プロンプトが表示されます。

. LOADERプロンプトで「_bye_」と入力します。
. コンソールメッセージが停止したら、<enter>キーを押します。
+
** _login_ プロンプトが表示されたら、次の手順に進みます。
** ログイン プロンプトが表示されない場合は、パートナー ノードにログインします。


. override-destination-checks オプションを使用してルートのみを返します。
+
`storage failover giveback -ofnode impaired-node -only-root true -override -destination-checks true`

+

NOTE: 次のコマンドは、診断モードの特権レベルでのみ使用できます。権限レベルの詳細については、以下を参照してください。link:https://docs.netapp.com/us-en/ontap/system-admin/administrative-privilege-levels-concept.html["ONTAP CLIコマンドの権限レベルを理解する"^] 。

+
エラーが発生した場合は、にお問い合わせください https://support.netapp.com["ネットアップサポート"]。

. ギブバック レポートが完了してから 5 分待ってから、フェイルオーバーとギブバックのステータスを確認します。
+
`storage failover show`そして `storage failover show-giveback`

+

NOTE: 次のコマンドは、診断モードの特権レベルでのみ使用できます。

. HA 内部接続リンクがダウンしている場合は、次のようにしてリンクを復旧します。
+
`system ha interconnect link on -node healthy-node -link 0`

+
`system ha interconnect link on -node healthy-node -link 1`

. 障害コントローラのストレージをギブバックして、障害コントローラを通常動作に戻します。
+
「 storage failover giveback -ofnode _impaired_node_name _

. 自動ギブバックが無効になっている場合は、再度有効にします。 `storage failover modify -node local -auto-giveback-of true` 。
. AutoSupportが有効になっている場合は、ケースの自動作成をリストアまたは抑制解除します。 `system node autosupport invoke -node * -type all -message MAINT=END`




== 手順4：ライセンスをインストールし、シリアル番号を登録する

システム管理モジュールを交換すると、コントローラのシステムシリアル番号 (SSN) が変更されます。障害のあるノードが標準（ノードロック）ライセンスを必要とするONTAP機能を使用していた場合は、ノードに新しいライセンスをインストールする必要があります。標準ライセンスを使用する機能では、クラスタ内の各ノードにその機能用のキーが必要です。

.このタスクについて
ライセンスキーをインストールするまでは、標準ライセンスを必要とする機能を引き続きノードで使用できます。ただし、該当する機能のライセンスがクラスタ内でそのノードにしかなかった場合、機能の設定を変更することはできません。また、ライセンスされていない機能をノードで使用するとライセンス契約に違反する可能性があるため、できるだけ早くノードのに交換用ライセンスキーをインストールする必要があります。

.作業を開始する前に
新しいシステム シリアル番号のNetAppライセンス ファイル (NLF) が必要です。  NetAppライセンスファイルの詳細については、以下を参照してください。link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/ONTAP_9.10.1_and_later_licensing_overview["ONTAP 9.10.1以降のライセンスの概要"^] 。

ライセンス キーをインストールする期間は 90 日間です。この期間を過ぎると、古いライセンスはすべて無効になります。有効なライセンス キーをインストールした後、猶予期間が終了する前に 24 時間以内にすべてのキーをインストールする必要があります。


NOTE: システムが最初にONTAP 9.15.1以降を実行していた場合は、link:https://kb.netapp.com/on-prem/ontap/OHW/OHW-KBs/Post_Motherboard_Replacement_Process_to_update_Licensing_on_a_AFF_FAS_system["マザーボードの交換後プロセスを実行して、AFF / FASシステムのライセンスを更新"^] 。ご使用のシステムの初期ONTAPリリースが不明な場合は、link:https://hwu.netapp.com["NetApp Hardware Universe の略"^]詳細についてはこちらをご覧ください。

.手順
. 新しいライセンスキーが必要な場合は、で交換用ライセンスキーを取得します https://mysupport.netapp.com/site/global/dashboard["ネットアップサポートサイト"] [ ソフトウェアライセンス ] の [ マイサポート ] セクションで、
+

NOTE: 必要な新しいライセンスキーが自動的に生成され、 E メールで送信されます。ライセンスキーが記載された E メールが 30 日以内に届かないは、テクニカルサポートにお問い合わせください。

. 各ライセンス キーはONTAP System Manager を通じてインストールされます。
+
詳細については、以下を参照してください。 link:https://docs.netapp.com/us-en/ontap/task_admin_enable_new_features.html["ONTAP System Managerでライセンスキーを追加して新機能を有効にする"^] 。

. 必要に応じて、古いライセンスを削除します。
+
.. 使用されていないライセンスを確認してください : 「 license clean-up-unused -simulate 」
.. リストが正しい場合は、未使用のライセンス「 license clean-up-unused 」を削除します


. システムのシリアル番号をネットアップサポートに登録します。
+
** AutoSupport が有効になっている場合は、 AutoSupport メッセージを送信してシリアル番号を登録します。
** AutoSupport が有効になっていない場合は、を呼び出します https://mysupport.netapp.com["ネットアップサポート"] をクリックしてシリアル番号を登録します。






== 手順 5 ：障害が発生したパーツをネットアップに返却する

障害が発生したパーツは、キットに付属のRMA指示書に従ってNetAppに返却してください。 https://mysupport.netapp.com/site/info/rma["パーツの返品と交換"]詳細については、ページを参照してください。
